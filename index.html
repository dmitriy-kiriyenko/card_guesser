<!DOCTYPE html>
<html>
<head>
  <title>Guesser</title>
  <script type="text/javascript" src="/scripts/jquery.js"></script>
  <script type="text/javascript" src="/scripts/underscore.js"></script>
  <script type="text/javascript" src="/scripts/bacon.js"></script>
  <script type="text/javascript" src="/scripts/bacon-ui.js"></script>

  <style type="text/css">
    hr {
      clear: both;
      margin: 20px 0;
      visibility: hidden;
    }

    div.main div {
      float: left;
      margin-right: 10px;
    }

    div.main div.given img.current {
      border: 3px solid red;
    }

    div.main div.guess {
      margin-left: 40px;
    }

    div.main div img {
      max-height: 272px;
      max-width: 188px;
      cursor: pointer;
    }

    div.suite div {
      float: left;
      margin-right: 10px;
    }

    div.suite img {
      max-height: 272px;
      max-width: 188px;
      cursor: pointer;
    }

    div.value div {
      float: left;
      margin-right: 10px;
    }

    div.value div.cancel img,
    div.value div.pick img {
      max-height: 136px;
      max-width: 94px;
      cursor: pointer;
    }

  </style>
</head>
<body>

  <div class="main">
    <div class="given">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>

    <div class="given">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>

    <div class="given">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>

    <div class="given">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>

    <div class="guess">
      <img src="/images/red_joker.png" alt="unknown" />
    </div>
  </div>

  <hr />

  <div class="suite" style="display: none">
    <div class="pick">
      <img src="/images/ace_of_clubs.png" alt="unknown" data-suite="2" />
    </div>

    <div class="pick">
      <img src="/images/ace_of_diamonds.png" alt="unknown" data-suite="3" />
    </div>

    <div class="pick">
      <img src="/images/ace_of_hearts.png" alt="unknown" data-suite="4" />
    </div>

    <div class="pick">
      <img src="/images/ace_of_spades.png" alt="unknown" data-suite="1" />
    </div>
  </div>

  <hr />

  <div class="value value-1" style="display:none">
    <div class="cancel">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>
    <div class="pick">
      <img src="/images/ace_of_spades.png" alt="unknown" data-value="1" />
    </div>
    <div class="pick">
      <img src="/images/2_of_spades.png" alt="unknown" data-value="2" />
    </div>
    <div class="pick">
      <img src="/images/3_of_spades.png" alt="unknown" data-value="3" />
    </div>
    <div class="pick">
      <img src="/images/4_of_spades.png" alt="unknown" data-value="4" />
    </div>
    <div class="pick">
      <img src="/images/5_of_spades.png" alt="unknown" data-value="5" />
    </div>
    <div class="pick">
      <img src="/images/6_of_spades.png" alt="unknown" data-value="6" />
    </div>
    <div class="pick">
      <img src="/images/7_of_spades.png" alt="unknown" data-value="7" />
    </div>
    <div class="pick">
      <img src="/images/8_of_spades.png" alt="unknown" data-value="8" />
    </div>
    <div class="pick">
      <img src="/images/9_of_spades.png" alt="unknown" data-value="9" />
    </div>
    <div class="pick">
      <img src="/images/10_of_spades.png" alt="unknown" data-value="10" />
    </div>
    <div class="pick">
      <img src="/images/jack_of_spades.png" alt="unknown" data-value="11" />
    </div>
    <div class="pick">
      <img src="/images/queen_of_spades.png" alt="unknown" data-value="12" />
    </div>
    <div class="pick">
      <img src="/images/king_of_spades.png" alt="unknown" data-value="13" />
    </div>
  </div>

  <hr />

  <div class="value value-2" style="display:none">
    <div class="cancel">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>
    <div class="pick">
      <img src="/images/ace_of_clubs.png" alt="unknown" data-value="1" />
    </div>
    <div class="pick">
      <img src="/images/2_of_clubs.png" alt="unknown" data-value="2" />
    </div>
    <div class="pick">
      <img src="/images/3_of_clubs.png" alt="unknown" data-value="3" />
    </div>
    <div class="pick">
      <img src="/images/4_of_clubs.png" alt="unknown" data-value="4" />
    </div>
    <div class="pick">
      <img src="/images/5_of_clubs.png" alt="unknown" data-value="5" />
    </div>
    <div class="pick">
      <img src="/images/6_of_clubs.png" alt="unknown" data-value="6" />
    </div>
    <div class="pick">
      <img src="/images/7_of_clubs.png" alt="unknown" data-value="7" />
    </div>
    <div class="pick">
      <img src="/images/8_of_clubs.png" alt="unknown" data-value="8" />
    </div>
    <div class="pick">
      <img src="/images/9_of_clubs.png" alt="unknown" data-value="9" />
    </div>
    <div class="pick">
      <img src="/images/10_of_clubs.png" alt="unknown" data-value="10" />
    </div>
    <div class="pick">
      <img src="/images/jack_of_clubs.png" alt="unknown" data-value="11" />
    </div>
    <div class="pick">
      <img src="/images/queen_of_clubs.png" alt="unknown" data-value="12" />
    </div>
    <div class="pick">
      <img src="/images/king_of_clubs.png" alt="unknown" data-value="13" />
    </div>
  </div>

  <hr />

  <div class="value value-3" style="display:none">
    <div class="cancel">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>
    <div class="pick">
      <img src="/images/ace_of_diamonds.png" alt="unknown" data-value="1" />
    </div>
    <div class="pick">
      <img src="/images/2_of_diamonds.png" alt="unknown" data-value="2" />
    </div>
    <div class="pick">
      <img src="/images/3_of_diamonds.png" alt="unknown" data-value="3" />
    </div>
    <div class="pick">
      <img src="/images/4_of_diamonds.png" alt="unknown" data-value="4" />
    </div>
    <div class="pick">
      <img src="/images/5_of_diamonds.png" alt="unknown" data-value="5" />
    </div>
    <div class="pick">
      <img src="/images/6_of_diamonds.png" alt="unknown" data-value="6" />
    </div>
    <div class="pick">
      <img src="/images/7_of_diamonds.png" alt="unknown" data-value="7" />
    </div>
    <div class="pick">
      <img src="/images/8_of_diamonds.png" alt="unknown" data-value="8" />
    </div>
    <div class="pick">
      <img src="/images/9_of_diamonds.png" alt="unknown" data-value="9" />
    </div>
    <div class="pick">
      <img src="/images/10_of_diamonds.png" alt="unknown" data-value="10" />
    </div>
    <div class="pick">
      <img src="/images/jack_of_diamonds.png" alt="unknown" data-value="11" />
    </div>
    <div class="pick">
      <img src="/images/queen_of_diamonds.png" alt="unknown" data-value="12" />
    </div>
    <div class="pick">
      <img src="/images/king_of_diamonds.png" alt="unknown" data-value="13" />
    </div>
  </div>

  <hr />

  <div class="value value-4" style="display:none">
    <div class="cancel">
      <img src="/images/black_joker.png" alt="unknown" />
    </div>
    <div class="pick">
      <img src="/images/ace_of_hearts.png" alt="unknown" data-value="1" />
    </div>
    <div class="pick">
      <img src="/images/2_of_hearts.png" alt="unknown" data-value="2" />
    </div>
    <div class="pick">
      <img src="/images/3_of_hearts.png" alt="unknown" data-value="3" />
    </div>
    <div class="pick">
      <img src="/images/4_of_hearts.png" alt="unknown" data-value="4" />
    </div>
    <div class="pick">
      <img src="/images/5_of_hearts.png" alt="unknown" data-value="5" />
    </div>
    <div class="pick">
      <img src="/images/6_of_hearts.png" alt="unknown" data-value="6" />
    </div>
    <div class="pick">
      <img src="/images/7_of_hearts.png" alt="unknown" data-value="7" />
    </div>
    <div class="pick">
      <img src="/images/8_of_hearts.png" alt="unknown" data-value="8" />
    </div>
    <div class="pick">
      <img src="/images/9_of_hearts.png" alt="unknown" data-value="9" />
    </div>
    <div class="pick">
      <img src="/images/10_of_hearts.png" alt="unknown" data-value="10" />
    </div>
    <div class="pick">
      <img src="/images/jack_of_hearts.png" alt="unknown" data-value="11" />
    </div>
    <div class="pick">
      <img src="/images/queen_of_hearts.png" alt="unknown" data-value="12" />
    </div>
    <div class="pick">
      <img src="/images/king_of_hearts.png" alt="unknown" data-value="13" />
    </div>
  </div>

  <script type="text/javascript">
    var displaySuite = function (flag) { $('.suite').toggle(!!flag); }
    var highlightCurrent = function (el) {
      $('.main .given img').removeClass('current');
      $(el).addClass('current');
    }
    var hideValue = function() { $('.value').hide(); }
    var displayValue = function (suite) {
      hideValue();
      $('.value-' + suite).show();
    }
    var toImagePath = function (card) {
      var suite = card[0];
      var value = card[1];
      suites = ['never', 'spades', 'clubs', 'diamonds', 'hearts'];
      values = ['never', 'ace', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'jack', 'queen', 'king'];
      return '/images/' + values[value] + '_of_' + suites[suite] + '.png';
    }
    var setImage = function (src, image) {
      image.attr('src', src);
      image.removeClass('current');
    }

    var currentImage = $('.main .given img').clickE().map(function (e) { return $(e.target); });
    currentImage.onValue(displaySuite);
    currentImage.onValue(highlightCurrent);

    var currentSuite = $('.suite').clickE().map(function (e) { return +$(e.target).attr('data-suite'); } )
    currentSuite.not().onValue(displaySuite);
    currentSuite.onValue(displayValue);

    var cancelValue = $('.value .cancel').clickE();
    cancelValue.onValue(hideValue);
    cancelValue.onValue(displaySuite);

    var currentValue = $('.value .pick').clickE().map(function (e) { return +$(e.target).attr('data-value'); })
    currentValue.onValue(hideValue);

    currentCard = currentSuite.zip(currentValue);
    currentCard.map(toImagePath).zip(currentImage).onValues(setImage);
  </script>

</body>
</html>
